<ng-container *ngIf="loading; else loaded">
  <div class="min-h-screen bg-[#111416] text-slate-100 flex items-center justify-center">
    <p class="text-slate-400 text-sm">Cargando rutina...</p>
  </div>
</ng-container>

<ng-template #loaded>
  <div class="min-h-screen bg-[#111416] text-slate-100" *ngIf="routine as r; else errorTpl">
    <div class="max-w-4xl mx-auto px-4 lg:px-8 pb-10">

      <!-- Back -->
      <button
        (click)="onBack()"
        class="flex items-center gap-2 py-4 text-sm text-slate-300 hover:text-slate-100 transition"
      >
        ‚Üê Volver
      </button>

      <!-- HERO: t√≠tulo + resumen -->
      <section
        class="bg-[#171a1d] rounded-3xl shadow-[0_18px_60px_rgba(0,0,0,0.7)]
               px-5 py-6 md:px-8 md:py-8
               flex flex-col gap-4 md:flex-row md:items-center md:justify-between"
      >
        <!-- T√≠tulo -->
        <div class="text-center md:text-left space-y-1">
          <h1 class="text-2xl md:text-3xl font-extrabold leading-snug">
            {{ r.name }}
          </h1>
          <p class="text-sm md:text-base text-slate-400">
            {{ r.durationWeeks }} semanas de entrenamiento
          </p>
        </div>

        <!-- Chips principales -->
        <div
          class="flex flex-wrap justify-center md:justify-end gap-2 text-[11px] md:text-xs"
        >
          <span
            class="inline-flex items-center gap-2 px-3 py-1 rounded-full
                   bg-slate-900 border border-teal-400/60 text-teal-300 font-semibold"
          >
            üß¨ {{ r.goal }}
          </span>

          <span
            class="inline-flex items-center gap-2 px-3 py-1 rounded-full
                   bg-slate-900 border border-amber-400/60 text-amber-300 font-semibold"
          >
            ‚≠ê {{ r.recommendedLevel }}
          </span>

          <span
            class="inline-flex items-center gap-2 px-3 py-1 rounded-full
                   bg-slate-900 border border-slate-600 text-slate-100"
          >
            üìÜ {{ r.daysPerWeek }} d√≠as/semana
          </span>
        </div>
      </section>

      <!-- Descripci√≥n -->
      <section class="mt-7 space-y-3 text-sm md:text-base leading-relaxed text-slate-200">
        <p>
          {{ r.longDescription }}
        </p>
        <p class="text-slate-400">
          Recomendada para nivel
          <span class="font-semibold text-teal-300">
            {{ r.recommendedLevel }}
          </span>
    
        </p>
      </section>

      <!-- Bot√≥n principal -->
      <div class="mt-8">
        <button
          (click)="onStartRoutine()"
          [disabled]="startingRoutine"
          class="w-full md:w-auto md:min-w-[220px] inline-flex items-center justify-center gap-2 px-6 py-3
                 rounded-2xl bg-teal-400 text-slate-950 font-semibold text-sm md:text-base
                 hover:brightness-110 active:translate-y-[1px] transition
                 shadow-[0_10px_25px_rgba(45,212,191,0.4)]
                 disabled:opacity-60 disabled:cursor-not-allowed"
        >
          <!-- Spinner cuando est√° cargando -->
          <svg *ngIf="startingRoutine" class="animate-spin w-5 h-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
          </svg>
          <span *ngIf="!startingRoutine">Empezar rutina</span>
          <span *ngIf="startingRoutine">Asignando...</span>
        </button>
      </div>

      <!-- Bloques / sesiones -->
      <section class="mt-8" *ngIf="r.blocks?.length">
        

        <div class="space-y-6">
          <div *ngFor="let b of r.blocks; trackBy: trackByBlock" class="space-y-3">
            <h3 class="text-teal-200 font-semibold text-xs md:text-sm uppercase tracking-wide">
              {{ b.blockTitle }}
            </h3>

            <div class="space-y-3">
              <div
                *ngFor="let s of b.sessions; trackBy: trackBySession"
                class="bg-[#171a1d] rounded-2xl px-4 py-3 md:px-5 md:py-4
                       flex items-center justify-between gap-3 shadow-md
                       border border-slate-800/60 opacity-75"
              >
                <div class="flex-1">
                  <p class="text-sm md:text-base font-semibold uppercase tracking-wide text-slate-300">
                    {{ s.title }}
                  </p>
                  <p class="text-xs md:text-sm text-amber-400/70">
                    {{ s.totalSeries }} series
                  </p>
                  <p class="text-xs md:text-sm text-slate-500">
                    {{ s.mainMuscles }}
                  </p>
                </div>
                <!-- Icono de candado -->
                <div class="flex items-center gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      

     
    </div>
  </div>

  <ng-template #errorTpl>
    <div class="min-h-screen bg-[#111416] text-slate-100 flex items-center justify-center">
      <p class="text-red-400 text-sm">
        {{ error || 'Ocurri√≥ un error al cargar la rutina.' }}
      </p>
    </div>
  </ng-template>
</ng-template>
