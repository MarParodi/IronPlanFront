<div class="min-h-screen bg-gradient-to-b from-[#0d0f11] via-[#111318] to-[#0d0f11]">
  
  <!-- Header fijo -->
  <header class="sticky top-0 z-40 bg-[#0d0f11]/95 backdrop-blur-md border-b border-slate-800/40">
    <div class="max-w-lg mx-auto px-4 h-14 flex items-center justify-between">
      <!-- User icon button -->
      <button (click)="goBack()" 
              class="w-10 h-10 flex items-center justify-center rounded-full bg-teal-500/20 hover:bg-teal-500/30 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-teal-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z" />
        </svg>
      </button>
      
      <h1 class="text-lg font-semibold text-white">Perfil</h1>
      
      <!-- Settings button -->
      <button (click)="goToSettings()" 
              class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-800/50 hover:bg-slate-700/60 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869l.214-1.28Z" />
          <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
        </svg>
      </button>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="loading" class="flex flex-col items-center justify-center py-20">
    <div class="w-12 h-12 border-4 border-teal-400/30 border-t-teal-400 rounded-full animate-spin"></div>
    <p class="mt-4 text-slate-400 text-sm">Cargando perfil...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="max-w-lg mx-auto px-4 py-20 text-center">
    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-rose-500/10 flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-rose-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
      </svg>
    </div>
    <p class="text-slate-400 mb-4">{{ error }}</p>
    <button (click)="loadProfile()" 
            class="px-6 py-2 bg-teal-500 hover:bg-teal-400 text-white font-medium rounded-lg transition-colors">
      Reintentar
    </button>
  </div>

  <!-- Profile Content -->
  <div *ngIf="profile && !loading" class="max-w-lg mx-auto px-4 pb-8 space-y-4">
    
    <!-- User Card -->
    <div class="mt-4 p-5 rounded-2xl bg-gradient-to-br from-slate-800/60 to-slate-900/40 border border-slate-700/50 backdrop-blur-sm">
      <div class="flex items-center gap-4">
        <!-- Avatar -->
        <div class="relative">
          <div class="w-20 h-20 rounded-full bg-gradient-to-br from-teal-400 to-teal-600 flex items-center justify-center ring-4 ring-teal-400/20">
            <span class="text-2xl font-bold text-white">{{ getInitials() }}</span>
          </div>
          <!-- Level indicator -->
          <div class="absolute -bottom-1 -right-1 w-7 h-7 rounded-full bg-amber-500 flex items-center justify-center ring-2 ring-[#111318]">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
            </svg>
          </div>
        </div>

        <!-- User Info -->
        <div class="flex-1 min-w-0">
          <h2 class="text-xl font-bold text-white truncate">{{"@"}}{{ profile.header.username }}</h2>
          
          <!-- Rank Badge -->
          <div class="inline-flex items-center gap-1.5 mt-1 px-2.5 py-1 rounded-full bg-teal-500/20 border border-teal-500/30">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-3.5 h-3.5 text-teal-400" fill="currentColor" viewBox="0 0 24 24">
              <path d="M5 3H19C19.5523 3 20 3.44772 20 4V20C20 20.5523 19.5523 21 19 21H5C4.44772 21 4 20.5523 4 20V4C4 3.44772 4.44772 3 5 3ZM12 11L16 6H8L12 11ZM12 13L8 18H16L12 13Z"/>
            </svg>
            <span class="text-xs font-semibold text-teal-400">{{ profile.header.xpRankLabel || 'Sin rango' }}</span>
          </div>
          
          <!-- XP Progress Bar -->
          <div class="mt-3">
            <div class="h-2 w-full bg-slate-700/60 rounded-full overflow-hidden">
              <div class="h-full bg-gradient-to-r from-teal-500 to-teal-400 rounded-full transition-all duration-500"
                   [style.width.%]="getXpProgress()">
              </div>
            </div>
            <p *ngIf="getNextRankInfo()" class="mt-1 text-[10px] text-slate-500">
              {{ getXpToNextRank() | number }} XP para {{ getNextRankInfo()?.label }}
            </p>
          </div>
        </div>

        <!-- XP Display -->
        <div class="text-right">
          <span class="text-2xl font-bold text-teal-400">{{ profile.header.lifetimeXp | number }}</span>
          <p class="text-xs text-slate-500 uppercase tracking-wider">XP</p>
        </div>
      </div>
    </div>

    <!-- Stats Card -->
    <div class="p-5 rounded-2xl bg-slate-800/40 border border-slate-700/40">
      <div class="grid grid-cols-3 divide-x divide-slate-700/40">
        <div class="text-center px-2">
          <span class="block text-2xl font-bold text-teal-400">{{ profile.stats.totalWorkouts }}</span>
          <span class="text-xs text-slate-400">Entrenamientos</span>
        </div>
        <div class="text-center px-2">
          <span class="block text-2xl font-bold text-teal-400">{{ profile.stats.totalRoutinesOwned }}</span>
          <span class="text-xs text-slate-400">Rutinas</span>
        </div>
        <div class="text-center px-2">
          <span class="block text-2xl font-bold text-teal-400">{{ profile.stats.totalXpActions }}</span>
          <span class="text-xs text-slate-400">XP Acciones</span>
        </div>
      </div>
    </div>

    <!-- Action Buttons -->
    <div class="space-y-3">
      <button (click)="goToRoutineHistory()" 
              class="w-full flex items-center gap-3 p-4 rounded-xl bg-slate-800/40 border border-slate-700/40 hover:bg-slate-700/40 hover:border-teal-500/30 transition-all group">
        <div class="w-10 h-10 rounded-full bg-slate-700/60 flex items-center justify-center group-hover:bg-teal-500/20 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-400 group-hover:text-teal-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
          </svg>
        </div>
        <span class="flex-1 text-left text-sm font-medium text-slate-300 group-hover:text-white transition-colors">Ver historial de rutinas</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-500 group-hover:text-teal-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
        </svg>
      </button>

      <button (click)="goToMyCreatedRoutines()" 
              class="w-full flex items-center gap-3 p-4 rounded-xl bg-slate-800/40 border border-slate-700/40 hover:bg-slate-700/40 hover:border-teal-500/30 transition-all group">
        <div class="w-10 h-10 rounded-full bg-slate-700/60 flex items-center justify-center group-hover:bg-teal-500/20 transition-colors">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-400 group-hover:text-teal-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" />
          </svg>
        </div>
        <span class="flex-1 text-left text-sm font-medium text-slate-300 group-hover:text-white transition-colors">Ver mis rutinas creadas</span>
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-500 group-hover:text-teal-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
        </svg>
      </button>
    </div>

    <!-- Achievements Section -->
    <div class="mt-6">
      <div class="flex items-center justify-between mb-3">
        <h3 class="text-base font-semibold text-white">Hazañas</h3>
        <button (click)="goToAllAchievements()" class="text-sm font-medium text-teal-400 hover:text-teal-300 transition-colors">
          Ver todas
        </button>
      </div>
      
      <div class="grid grid-cols-4 gap-3">
        <div *ngFor="let achievement of achievements; let i = index"
             class="flex flex-col items-center p-3 rounded-xl bg-slate-800/40 border border-slate-700/40"
             [ngClass]="{'opacity-40': !achievement.unlocked, 'border-amber-500/30': achievement.unlocked}">
          <div class="w-12 h-12 rounded-full flex items-center justify-center"
               [ngClass]="achievement.unlocked ? 'bg-amber-500/20' : 'bg-slate-700/40'">
            <!-- Trophy icon for first routine -->
            <svg *ngIf="achievement.icon === 'trophy'" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" 
                 [ngClass]="achievement.unlocked ? 'text-amber-400' : 'text-slate-500'"
                 fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"/>
            </svg>
            <!-- Medal icon for 10 workouts -->
            <svg *ngIf="achievement.icon === 'medal'" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6"
                 [ngClass]="achievement.unlocked ? 'text-amber-400' : 'text-slate-500'"
                 fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 0 1 3 3h-15a3 3 0 0 1 3-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 0 1-.982-3.172M9.497 14.25a7.454 7.454 0 0 0 .981-3.172" />
            </svg>
            <!-- Target icon for weekly goal -->
            <svg *ngIf="achievement.icon === 'target'" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6"
                 [ngClass]="achievement.unlocked ? 'text-amber-400' : 'text-slate-500'"
                 fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
            <!-- Fire icon for streak -->
            <svg *ngIf="achievement.icon === 'fire'" xmlns="http://www.w3.org/2000/svg" class="w-6 h-6"
                 [ngClass]="achievement.unlocked ? 'text-orange-400' : 'text-slate-500'"
                 fill="currentColor" viewBox="0 0 24 24">
              <path d="M12 23C16.1421 23 19.5 19.6421 19.5 15.5C19.5 14.6345 19.2697 13.8032 19 13C19 13 18.5 14.5 17 14.5C17 14.5 18.151 11.4621 16 8C14.5 9.5 13.5 10 12 10C12 10 12.5 7.5 11 5C9.5 6.5 8 8.75 8 12C8 12 7 12 6 11C6 11 5 13 5 15.5C5 19.6421 7.85786 23 12 23ZM12 21C10.3431 21 9 19.6569 9 18C9 16.3431 10.3431 15 12 15C13.6569 15 15 16.3431 15 18C15 19.6569 13.6569 21 12 21Z"/>
            </svg>
          </div>
          <span class="mt-2 text-[10px] text-center text-slate-400 leading-tight">{{ achievement.name }}</span>
        </div>
      </div>
    </div>

    <!-- Recent Workouts Section -->
    <div class="mt-6">
      <h3 class="text-base font-semibold text-white mb-3">Últimos registros</h3>
      
      <div *ngIf="profile.recentWorkouts.length === 0" 
           class="p-6 rounded-xl bg-slate-800/30 border border-slate-700/30 text-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 mx-auto text-slate-600 mb-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z" />
        </svg>
        <p class="text-slate-500 text-sm">Aún no tienes entrenamientos registrados</p>
      </div>

      <div *ngIf="profile.recentWorkouts.length > 0" class="space-y-2">
        <button *ngFor="let workout of profile.recentWorkouts"
                (click)="goToWorkoutDetail(workout.sessionId)"
                class="w-full p-4 rounded-xl bg-slate-800/40 border border-slate-700/40 hover:bg-slate-700/40 hover:border-slate-600/60 transition-all text-left group">
          <div class="flex items-center justify-between">
            <div class="flex-1 min-w-0">
              <h4 class="font-medium text-white truncate group-hover:text-teal-400 transition-colors">
                {{ workout.routineName }}
              </h4>
              <div class="flex items-center gap-3 mt-1 text-xs text-slate-500">
                <span>{{ formatRelativeDate(workout.date) }}</span>
                <span class="w-1 h-1 rounded-full bg-slate-600"></span>
                <span>{{ formatDuration(workout.durationMinutes) }}</span>
              </div>
            </div>
            <div class="text-right ml-4">
              <span class="text-sm font-semibold text-teal-400">{{ workout.totalSeries }} series</span>
              <p class="text-xs text-slate-500">{{ formatWeight(workout.totalWeightKg) }}</p>
            </div>
          </div>
        </button>
      </div>
    </div>

    <!-- Member Since -->
    <div class="mt-6 text-center">
      <p class="text-xs text-slate-600">
        Miembro desde {{ formatDate(profile.header.joinedAt) }}
      </p>
    </div>
  </div>
</div>
