<div class="min-h-screen bg-gradient-to-b from-[#0d0f11] via-[#111318] to-[#0d0f11]">
  
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-[#0d0f11]/95 backdrop-blur-md border-b border-slate-800/40">
    <div class="max-w-lg mx-auto px-4 h-14 flex items-center justify-between">
      <button (click)="goBack()" class="w-10 h-10 flex items-center justify-center rounded-full bg-slate-800/50 hover:bg-slate-700/60 transition-colors">
        <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 text-slate-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
        </svg>
      </button>
      <h1 class="text-lg font-semibold text-white">Mis Estad√≠sticas</h1>
      <div class="w-10"></div>
    </div>
  </header>

  <!-- Loading -->
  <div *ngIf="loading" class="flex flex-col items-center justify-center py-20">
    <div class="w-12 h-12 border-4 border-teal-400/30 border-t-teal-400 rounded-full animate-spin"></div>
    <p class="mt-4 text-slate-400 text-sm">Cargando estad√≠sticas...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error && !loading" class="max-w-lg mx-auto px-4 py-20 text-center">
    <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-rose-500/10 flex items-center justify-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-rose-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
      </svg>
    </div>
    <p class="text-slate-400 mb-4">{{ error }}</p>
    <button (click)="loadStats()" class="px-6 py-2 bg-teal-500 hover:bg-teal-400 text-white font-medium rounded-lg transition-colors">Reintentar</button>
  </div>

  <!-- Content -->
  <div *ngIf="!loading && !error && summary" class="max-w-lg mx-auto px-4 pb-8">
    
    <!-- Tabs -->
    <div class="mt-4 flex gap-2 p-1 bg-slate-800/40 rounded-xl">
      <button (click)="setTab('overview')" 
              class="flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all"
              [ngClass]="activeTab === 'overview' ? 'bg-teal-500 text-white shadow-lg' : 'text-slate-400 hover:text-white'">
        Resumen
      </button>
      <button (click)="setTab('weekly')" 
              class="flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all"
              [ngClass]="activeTab === 'weekly' ? 'bg-teal-500 text-white shadow-lg' : 'text-slate-400 hover:text-white'">
        Semanal
      </button>
      <button (click)="setTab('exercises')" 
              class="flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-all"
              [ngClass]="activeTab === 'exercises' ? 'bg-teal-500 text-white shadow-lg' : 'text-slate-400 hover:text-white'">
        Ejercicios
      </button>
    </div>

    <!-- TAB: OVERVIEW -->
    <div *ngIf="activeTab === 'overview'" class="mt-6 space-y-4">
      
      <!-- Stats Grid -->
      <div class="grid grid-cols-2 gap-3">
        <!-- Entrenamientos -->
        <div class="p-4 rounded-2xl bg-gradient-to-br from-teal-500/20 to-teal-600/5 border border-teal-500/20">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-8 h-8 rounded-lg bg-teal-500/20 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-teal-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 13.5l10.5-11.25L12 10.5h8.25L9.75 21.75 12 13.5H3.75z" />
              </svg>
            </div>
            <span class="text-xs text-slate-400">Entrenamientos</span>
          </div>
          <span class="text-3xl font-bold text-white">{{ summary.totalWorkouts }}</span>
          <p class="text-xs text-teal-400 mt-1">{{ summary.avgWorkoutsPerWeek | number:'1.1-1' }}/sem promedio</p>
        </div>

        <!-- Volumen Total -->
        <div class="p-4 rounded-2xl bg-gradient-to-br from-amber-500/20 to-amber-600/5 border border-amber-500/20">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-amber-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v17.25m0 0c-1.472 0-2.882.265-4.185.75M12 20.25c1.472 0 2.882.265 4.185.75M18.75 4.97A48.416 48.416 0 0 0 12 4.5c-2.291 0-4.545.16-6.75.47m13.5 0c1.01.143 2.01.317 3 .52m-3-.52 2.62 10.726c.122.499-.106 1.028-.589 1.202a5.988 5.988 0 0 1-2.031.352 5.988 5.988 0 0 1-2.031-.352c-.483-.174-.711-.703-.59-1.202L18.75 4.971Zm-16.5.52c.99-.203 1.99-.377 3-.52m0 0 2.62 10.726c.122.499-.106 1.028-.589 1.202a5.989 5.989 0 0 1-2.031.352 5.989 5.989 0 0 1-2.031-.352c-.483-.174-.711-.703-.59-1.202L5.25 4.971Z" />
              </svg>
            </div>
            <span class="text-xs text-slate-400">Volumen Total</span>
          </div>
          <span class="text-3xl font-bold text-white">{{ formatVolume(summary.totalVolumeKg) }}</span>
          <div class="flex items-center gap-1 mt-1">
            <span *ngIf="getVolumeChange().isPositive" class="text-xs text-emerald-400">‚Üë {{ getVolumeChange().value }}%</span>
            <span *ngIf="!getVolumeChange().isPositive" class="text-xs text-rose-400">‚Üì {{ getVolumeChange().value }}%</span>
            <span class="text-xs text-slate-500">vs sem. anterior</span>
          </div>
        </div>

        <!-- Series Totales -->
        <div class="p-4 rounded-2xl bg-gradient-to-br from-violet-500/20 to-violet-600/5 border border-violet-500/20">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-8 h-8 rounded-lg bg-violet-500/20 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-violet-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 0 1 6 3.75h2.25A2.25 2.25 0 0 1 10.5 6v2.25a2.25 2.25 0 0 1-2.25 2.25H6a2.25 2.25 0 0 1-2.25-2.25V6ZM3.75 15.75A2.25 2.25 0 0 1 6 13.5h2.25a2.25 2.25 0 0 1 2.25 2.25V18a2.25 2.25 0 0 1-2.25 2.25H6A2.25 2.25 0 0 1 3.75 18v-2.25ZM13.5 6a2.25 2.25 0 0 1 2.25-2.25H18A2.25 2.25 0 0 1 20.25 6v2.25A2.25 2.25 0 0 1 18 10.5h-2.25a2.25 2.25 0 0 1-2.25-2.25V6ZM13.5 15.75a2.25 2.25 0 0 1 2.25-2.25H18a2.25 2.25 0 0 1 2.25 2.25V18A2.25 2.25 0 0 1 18 20.25h-2.25A2.25 2.25 0 0 1 13.5 18v-2.25Z" />
              </svg>
            </div>
            <span class="text-xs text-slate-400">Series Totales</span>
          </div>
          <span class="text-3xl font-bold text-white">{{ summary.totalSets | number }}</span>
        </div>

        <!-- Tiempo Total -->
        <div class="p-4 rounded-2xl bg-gradient-to-br from-rose-500/20 to-rose-600/5 border border-rose-500/20">
          <div class="flex items-center gap-2 mb-2">
            <div class="w-8 h-8 rounded-lg bg-rose-500/20 flex items-center justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-rose-400" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
              </svg>
            </div>
            <span class="text-xs text-slate-400">Tiempo Total</span>
          </div>
          <span class="text-3xl font-bold text-white">{{ formatDuration(summary.totalMinutes) }}</span>
        </div>
      </div>

      <!-- Streak & Consistency -->
      <div class="p-4 rounded-2xl bg-slate-800/40 border border-slate-700/40">
        <h3 class="font-semibold text-white mb-4 flex items-center gap-2">
          <span class="text-xl">üî•</span>
          Consistencia
        </h3>
        <div class="grid grid-cols-3 gap-4 text-center">
          <div>
            <span class="text-2xl font-bold text-orange-400">{{ summary.currentStreak }}</span>
            <p class="text-xs text-slate-400 mt-1">Racha actual</p>
          </div>
          <div>
            <span class="text-2xl font-bold text-amber-400">{{ summary.longestStreak }}</span>
            <p class="text-xs text-slate-400 mt-1">Mejor racha</p>
          </div>
          <div>
            <span class="text-2xl font-bold text-teal-400">{{ getConsistencyPercentage() }}%</span>
            <p class="text-xs text-slate-400 mt-1">Consistencia</p>
          </div>
        </div>
      </div>

      <!-- Top Exercises -->
      <div class="p-4 rounded-2xl bg-slate-800/40 border border-slate-700/40" *ngIf="summary.topExercises && summary.topExercises.length > 0">
        <h3 class="font-semibold text-white mb-4 flex items-center gap-2">
          <span class="text-xl">üèÜ</span>
          Top Ejercicios por Volumen
        </h3>
        <div class="space-y-3">
          <div *ngFor="let ex of summary.topExercises; let i = index" class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold"
                 [ngClass]="i === 0 ? 'bg-amber-500/20 text-amber-400' : i === 1 ? 'bg-slate-400/20 text-slate-300' : 'bg-orange-700/20 text-orange-400'">
              {{ i + 1 }}
            </div>
            <div class="flex-1 min-w-0">
              <p class="text-sm font-medium text-white truncate">{{ ex.exerciseName }}</p>
              <div class="flex items-center gap-2 mt-0.5">
                <span class="text-xs px-2 py-0.5 rounded-full border" [ngClass]="getMuscleColor(ex.primaryMuscle)">{{ ex.primaryMuscle }}</span>
              </div>
            </div>
            <div class="text-right">
              <p class="text-sm font-bold text-teal-400">{{ formatVolume(ex.totalVolumeKg) }}</p>
              <p *ngIf="ex.estimated1RM" class="text-xs text-slate-500">1RM: {{ ex.estimated1RM | number:'1.0-0' }} kg</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: WEEKLY -->
    <div *ngIf="activeTab === 'weekly'" class="mt-6 space-y-4">
      
      <!-- Volume Chart -->
      <div class="p-4 rounded-2xl bg-slate-800/40 border border-slate-700/40">
        <h3 class="font-semibold text-white mb-4">Volumen Semanal</h3>
        <div class="flex items-end justify-between gap-2 h-40">
          <div *ngFor="let week of (summary.weeklyHistory ?? []).slice().reverse(); let i = index" class="flex-1 flex flex-col items-center gap-2">
            <div class="w-full bg-slate-700/40 rounded-t-lg relative" style="height: 120px;">
              <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-teal-500 to-teal-400 rounded-t-lg transition-all"
                   [style.height.%]="getVolumeBarHeight(week.totalVolumeKg)">
              </div>
            </div>
            <span class="text-[9px] text-slate-500 text-center">{{ getWeekLabel(week) }}</span>
          </div>
        </div>
        <div class="mt-4 flex justify-between text-xs text-slate-400">
          <span>Hace 8 semanas</span>
          <span>Esta semana</span>
        </div>
      </div>

      <!-- Workouts per Week Chart -->
      <div class="p-4 rounded-2xl bg-slate-800/40 border border-slate-700/40">
        <h3 class="font-semibold text-white mb-4">Entrenamientos por Semana</h3>
        <div class="flex items-end justify-between gap-2 h-32">
          <div *ngFor="let week of (summary.weeklyHistory ?? []).slice().reverse()" class="flex-1 flex flex-col items-center gap-2">
            <div class="w-full bg-slate-700/40 rounded-t-lg relative" style="height: 80px;">
              <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-amber-500 to-amber-400 rounded-t-lg transition-all"
                   [style.height.%]="getWorkoutsBarHeight(week.workoutsCompleted)">
              </div>
            </div>
            <span class="text-xs font-bold text-slate-300">{{ week.workoutsCompleted }}</span>
          </div>
        </div>
      </div>

      <!-- Weekly Details -->
      <div class="space-y-3">
        <h3 class="font-semibold text-white">Detalle Semanal</h3>
        <div *ngFor="let week of summary.weeklyHistory" class="p-4 rounded-2xl bg-slate-800/30 border border-slate-700/30">
          <div class="flex items-center justify-between mb-3">
            <span class="text-sm font-medium text-white">{{ getWeekLabel(week) }}</span>
            <span class="text-xs px-2 py-1 rounded-full bg-teal-500/20 text-teal-400">{{ week.workoutsCompleted }} entrenos</span>
          </div>
          
          <!-- Days Grid -->
          <div class="grid grid-cols-7 gap-1 mb-3">
            <div *ngFor="let day of week.dailyBreakdown" class="flex flex-col items-center">
              <span class="text-[10px] text-slate-500 mb-1">{{ getDayName(day.dayOfWeek) }}</span>
              <div class="w-6 h-6 rounded-md flex items-center justify-center text-xs"
                   [ngClass]="day.hasWorkout ? 'bg-teal-500/30 text-teal-400' : 'bg-slate-700/30 text-slate-600'">
                {{ day.hasWorkout ? '‚úì' : '‚Äì' }}
              </div>
            </div>
          </div>

          <div class="flex justify-between text-xs text-slate-400">
            <span>{{ week.totalSets }} series</span>
            <span>{{ formatVolume(week.totalVolumeKg) }}</span>
            <span>{{ formatDuration(week.totalMinutes) }}</span>
          </div>
        </div>
      </div>
    </div>

    <!-- TAB: EXERCISES -->
    <div *ngIf="activeTab === 'exercises'" class="mt-6 space-y-4">
      
      <div *ngIf="!summary.topExercises || summary.topExercises.length === 0" class="text-center py-10">
        <div class="w-16 h-16 mx-auto mb-4 rounded-full bg-slate-800/60 flex items-center justify-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-slate-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m9-.75a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 3.75h.008v.008H12v-.008Z" />
          </svg>
        </div>
        <p class="text-slate-500">A√∫n no tienes datos de ejercicios</p>
      </div>

      <!-- PRs by Exercise -->
      <div *ngFor="let ex of summary.topExercises" class="p-4 rounded-2xl bg-slate-800/40 border border-slate-700/40">
        <div class="flex items-start justify-between mb-3">
          <div>
            <h4 class="font-semibold text-white">{{ ex.exerciseName }}</h4>
            <span class="text-xs px-2 py-0.5 rounded-full border mt-1 inline-block" [ngClass]="getMuscleColor(ex.primaryMuscle)">{{ ex.primaryMuscle }}</span>
          </div>
          <div *ngIf="ex.estimated1RM" class="text-right">
            <p class="text-xs text-slate-400">1RM Estimado</p>
            <p class="text-xl font-bold text-amber-400">{{ ex.estimated1RM | number:'1.0-0' }} kg</p>
          </div>
        </div>

        <div class="grid grid-cols-3 gap-3 mt-4">
          <div class="p-3 rounded-xl bg-slate-700/30 text-center">
            <p class="text-lg font-bold text-white">{{ ex.topWeight | number:'1.0-0' }}</p>
            <p class="text-[10px] text-slate-400">kg m√°ximo</p>
          </div>
          <div class="p-3 rounded-xl bg-slate-700/30 text-center">
            <p class="text-lg font-bold text-white">{{ ex.topReps || '‚Äì' }}</p>
            <p class="text-[10px] text-slate-400">reps &#64; max</p>
          </div>
          <div class="p-3 rounded-xl bg-slate-700/30 text-center">
            <p class="text-lg font-bold text-teal-400">{{ formatVolume(ex.totalVolumeKg) }}</p>
            <p class="text-[10px] text-slate-400">volumen total</p>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
